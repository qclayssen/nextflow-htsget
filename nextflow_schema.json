{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "https://raw.githubusercontent.com/quentinclayssen/nextflow-htsget/main/nextflow_schema.json",
  "title": "nextflow-htsget pipeline parameters",
  "description": "Schema describing parameters for the nextflow-htsget demonstration pipeline.",
  "type": "object",
  "definitions": {
    "input_output_options": {
      "title": "Input/output options",
      "description": "Define where the pipeline reads inputs and publishes results.",
      "type": "object",
      "properties": {
        "samplesheet": {
          "type": "string",
          "description": "Samplesheet of records to fetch (CSV/TSV) â€” select a Seqera dataset or provide a path.",
          "default": "samplesheet.csv",
          "format": "file-path",
          "schema": "assets/schema_samplesheet.json",
          "mimetype": "text/csv",
          "pattern": "^(?:|\\S+\\.(csv|tsv))$",
          "help_text": "Pick a workspace dataset (text/csv) or path to a CSV/TSV containing id,name,filetype,uri columns. Leave blank when using manual URLs.",
          "errorMessage": "Supply a CSV/TSV path without spaces ending in .csv or .tsv, or leave the field blank when using manual URLs."
        },
        "outdir": {
          "type": "string",
          "description": "Directory where the pipeline publishes result files.",
          "default": "results"
        },
        "workdir": {
          "type": "string",
          "description": "Location for Nextflow intermediate work files.",
          "default": "work"
        },
        "publish_dir_mode": {
          "type": "string",
          "description": "Method used to publish files from work directory to the results directory.",
          "default": "copy",
          "enum": [
            "symlink",
            "rellink",
            "link",
            "copy",
            "copyNoFollow",
            "move"
          ],
          "hidden": true
        }
      }
    },
    "manual_url_options": {
      "title": "Manual HTSGET inputs",
      "description": "Configure direct HTSGET URLs for quick demos.",
      "type": "object",
      "properties": {
        "htsget_urls": {
          "type": "array",
          "description": "Optional list of HTSGET endpoint URLs to fetch in addition to (or instead of) the samplesheet records.",
          "default": [],
          "items": {
            "type": "string",
            "format": "uri",
            "pattern": "^https?://.+$",
            "errorMessage": "Provide valid http(s) HTSGET URLs."
          },
          "help_text": "Add one or more HTSGET URLs for quick demos when a dedicated samplesheet is unavailable (clear the samplesheet field when using this option)."
        },
        "htsget_filetype": {
          "type": "string",
          "description": "Filetype to assign to the direct HTSGET URLs (controls downstream QC steps).",
          "default": "bam",
          "enum": [
            "bam",
            "fastq",
            "vcf"
          ],
          "help_text": "Choose the filetype for manual HTSGET URLs so the appropriate QC steps run.",
          "errorMessage": "Select one of bam, fastq, or vcf for manual URL inputs."
        }
      }
    },
    "runtime_options": {
      "title": "Execution settings",
      "description": "Resource limits and logging tweaks for local runs.",
      "type": "object",
      "properties": {
        "max_cpus": {
          "type": "integer",
          "description": "Hard limit for CPU requests across all processes.",
          "default": 4,
          "minimum": 1,
          "hidden": true
        },
        "max_memory": {
          "type": "string",
          "description": "Hard limit for memory requests; format like '16.GB'.",
          "default": "16.GB",
          "pattern": "^(?!\\s*$).+",
          "hidden": true
        },
        "max_time": {
          "type": "string",
          "description": "Hard limit for runtime; format like '8.h'.",
          "default": "8.h",
          "pattern": "^(?!\\s*$).+",
          "hidden": true
        },
        "monochrome_logs": {
          "type": "boolean",
          "description": "Disable ANSI colours in Nextflow log output.",
          "default": false
        }
      }
    },
    "metadata_options": {
      "title": "Pipeline metadata",
      "description": "Labels surfaced in launch helpers and reports.",
      "type": "object",
      "properties": {
        "config_profile_name": {
          "type": "string",
          "description": "Human-readable label describing the active configuration profile.",
          "default": "standard"
        },
        "config_profile_description": {
          "type": "string",
          "description": "Extended description for the active configuration profile shown by launch helpers.",
          "default": "Run locally with the bundled demo Docker image"
        },
        "trace_report_suffix": {
          "type": "string",
          "description": "Suffix appended to pipeline info filenames (defaults to current datetime when not supplied).",
          "hidden": true
        }
      }
    },
    "utility_flags": {
      "title": "Utility flags",
      "description": "Helper switches mostly used for automation or debugging.",
      "type": "object",
      "properties": {
        "validate_params": {
          "type": "boolean",
          "description": "Enable JSON-schema validation for parameter inputs.",
          "default": true
        },
        "help": {
          "type": "boolean",
          "description": "Display a short usage help message and exit.",
          "default": false,
          "hidden": true
        },
        "help_full": {
          "type": "boolean",
          "description": "Display the full parameter help output and exit.",
          "default": false,
          "hidden": true
        },
        "show_hidden": {
          "type": "boolean",
          "description": "Reveal hidden parameters in help output.",
          "default": false,
          "hidden": true
        },
        "version": {
          "type": "boolean",
          "description": "Display pipeline version and exit.",
          "default": false,
          "hidden": true
        }
      }
    }
  },
  "allOf": [
    {
      "$ref": "#/definitions/input_output_options"
    },
    {
      "$ref": "#/definitions/manual_url_options"
    },
    {
      "$ref": "#/definitions/runtime_options"
    },
    {
      "$ref": "#/definitions/metadata_options"
    },
    {
      "$ref": "#/definitions/utility_flags"
    },
    {
      "not": {
        "type": "object",
        "required": [
          "samplesheet",
          "htsget_urls"
        ],
        "properties": {
          "samplesheet": {
            "type": "string",
            "minLength": 1
          },
          "htsget_urls": {
            "type": "array",
            "minItems": 1
          }
        }
      }
    },
    {
      "anyOf": [
        {
          "type": "object",
          "properties": {
            "samplesheet": {
              "type": "string",
              "minLength": 1,
              "pattern": "^\\S+\\.(csv|tsv)$"
            }
          },
          "required": [
            "samplesheet"
          ]
        },
        {
          "type": "object",
          "properties": {
            "htsget_urls": {
              "type": "array",
              "minItems": 1
            }
          },
          "required": [
            "htsget_urls"
          ]
        }
      ]
    }
  ]
}
