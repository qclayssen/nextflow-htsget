{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "https://raw.githubusercontent.com/quentinclayssen/nextflow-htsget/main/nextflow_schema.json",
  "title": "nextflow-htsget pipeline parameters",
  "description": "Schema describing parameters for the nextflow-htsget demonstration pipeline.",
  "type": "object",
  "definitions": {
    "input_output_options": {
      "title": "Input/output options",
      "description": "Define where the pipeline reads inputs and publishes results.",
      "type": "object",
      "properties": {
        "samplesheet": {
          "type": "string",
          "description": "Samplesheet of records to fetch (CSV/TSV) — select a Seqera dataset or provide a path.",
          "default": "samplesheet.csv",
          "format": "file-path",
          "schema": "assets/schema_samplesheet.json",
          "mimetype": "text/csv",
          "pattern": "^(?:|\\S+\\.(csv|tsv))$",
          "help_text": "Pick a workspace dataset (text/csv) or path to a CSV/TSV containing id,name,filetype,uri columns. Leave blank when using manual URLs.",
          "errorMessage": "Supply a CSV/TSV path without spaces ending in .csv or .tsv, or leave the field blank when using manual URLs."
        },
        "outdir": {
          "type": "string",
          "description": "Directory where the pipeline publishes result files.",
          "default": "results"
        },
        "workdir": {
          "type": "string",
          "description": "Location for Nextflow intermediate work files.",
          "default": "work"
        },
        "publish_dir_mode": {
          "type": "string",
          "description": "Method used to publish files from work directory to the results directory.",
          "default": "copy",
          "enum": [
            "symlink",
            "rellink",
            "link",
            "copy",
            "copyNoFollow",
            "move"
          ],
          "hidden": true
        }
      }
    },
    "manual_url_options": {
      "title": "Manual HTSGET inputs",
      "description": "Configure direct HTSGET URLs for quick demos.",
      "type": "object",
      "properties": {
        "htsget_urls": {
          "type": "string",
          "description": "Optional list of HTSGET endpoint URLs to fetch in addition to (or instead of) the samplesheet records.",
          "default": "",
          "pattern": "^$|.*\\S.*",
          "help_text": "Enter one or more HTSGET URLs separated by commas or newlines. Leave blank to rely on the samplesheet.",
          "placeholder": "https://…/reads/sample1, https://…/reads/sample2"
        },
        "htsget_filetype": {
          "type": "string",
          "description": "Filetype to assign to the direct HTSGET URLs (controls downstream QC steps).",
          "default": "bam",
          "enum": [
            "bam",
            "fastq",
            "vcf"
          ],
          "help_text": "Choose the filetype for manual HTSGET URLs so the appropriate QC steps run.",
          "errorMessage": "Select one of bam, fastq, or vcf for manual URL inputs."
        }
      }
    }
  },
  "allOf": [
    {
      "$ref": "#/definitions/input_output_options"
    },
    {
      "$ref": "#/definitions/manual_url_options"
    },
    {
      "not": {
        "type": "object",
        "required": [
          "samplesheet",
          "htsget_urls"
        ],
        "properties": {
          "samplesheet": {
            "type": "string",
            "minLength": 1
          },
          "htsget_urls": {
            "type": "string",
            "minLength": 1,
            "pattern": ".*\\S.*"
          }
        }
      }
    },
    {
      "anyOf": [
        {
          "type": "object",
          "properties": {
            "samplesheet": {
              "type": "string",
              "minLength": 1,
              "pattern": "^\\S+\\.(csv|tsv)$"
            }
          },
          "required": [
            "samplesheet"
          ]
        },
        {
          "type": "object",
          "properties": {
            "htsget_urls": {
              "type": "string",
              "minLength": 1,
              "pattern": ".*\\S.*"
            }
          },
          "required": [
            "htsget_urls"
          ]
        }
      ]
    }
  ]
}
